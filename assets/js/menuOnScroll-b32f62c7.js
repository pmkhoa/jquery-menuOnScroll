!function(n){n.menuOnScroll=function(e,o){var t,i,l,c,u,s,r=this,a=n(e),f="ontouchstart"in window,h=0,m=new Array,d=new Array,w={menuActiveClass:"active",menuSelector:".menu-item",footerOffset:0,headerOffset:0,scrollOnClickOffset:20};r.init=function(){r.settings=s=n.extend({},w,o),r.run(),r.onResizeDone()},r.onResizeDone=function(){n(window).on("resize",function(){clearTimeout(u),resizeTimout=setTimeout(r.run(),300)})},r.run=function(){r.setDimension(),r.setMenuItems(),r.setContainerScrollTop(),r.menuOnClick(),r.windowOnScroll(),r.initMenuOnLoad()},r.windowOnScroll=function(){f===!0?r.touchScroll():r.mouseScroll()},r.touchScroll=function(){n(window).on({touchmove:function(){var e=n(this).scrollTop();e>=0&&r.updateMenuOnScroll(e)}})},r.mouseScroll=function(){n(window).on("scroll",function(){var e=n(this).scrollTop();e>=0&&r.updateMenuOnScroll(e)})},r.updateMenuOnScroll=function(e){r.setActiveMenuIndex(e),a.find("."+s.menuActiveClass).removeClass(s.menuActiveClass),n(t[h]).addClass(s.menuActiveClass)},r.initMenuOnLoad=function(){n(window).load(function(){var e=n(window).scrollTop();r.updateMenuOnScroll(e)})},r.menuOnClick=function(){n(s.menuSelector).find("a").on("click",function(e){if(e.preventDefault(),location.pathname.replace(/^\//,"")===this.pathname.replace(/^\//,"")&&location.hostname===this.hostname){var o=n(this.hash);o=o.length?o:n("[name="+this.hash.slice(1)+"]");var t=this.hash.slice(1);r.scrollTo(o,t)}})},r.scrollTo=function(e,o){var t=e.offset().top-s.scrollOnClickOffset;r.updateMenuOnScroll(t),n("html,body").stop().animate({scrollTop:t},300,function(){history.pushState?history.pushState(null,null,"#"+o):window.location.hash="#"+o})},r.setMenuItems=function(){t=n(s.menuSelector),i=t.length},r.setDimension=function(){l=n(window).height(),c=n(document).height()},r.setContainerScrollTop=function(){for(var e=0;i>e;e++){var o=n(t[e]).find("a").attr("href");d[e]=n(o).outerHeight(),m[e]=0===e?0:d[e-1]+m[e-1]}},r.setActiveMenuIndex=function(n){n=s.headerOffset+n;for(var e=0;i>e;e++){if(n+l>c-s.footerOffset){h=i-1;break}if(n>=m[e]&&n<m[e+1]){h=e;break}h=i-1}}},n.fn.menuOnScroll=function(e){return this.each(function(){n(this),plugin=new n.menuOnScroll(this,e),plugin.init()})}}(jQuery);